<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-messaging.js"></script>
<script src="pingPongGame.js"></script>
<script>
  firebase.initializeApp({
    apiKey: "AIzaSyBnEmZSsebYQ-7FW0vFkUY6HhYiSSNwag8",
    authDomain: "alexafusionplay.firebaseapp.com",
    projectId: "alexafusionplay",
    messagingSenderId: "972543288120"
  });
</script>
<style>
.login-btn {
  padding: 10px;
  font-size: 30px;
  text-align: center;
  margin-top: 15px;
}

.login-btn:hover {
    opacity: 0.7;
}

#facebook-login-btn {
  background: #3B5998;
  color: white;
}

#twitter-login-btn {
  background: #55ACEE;
  color: white;
}

#google-login-btn {
  background: #dd4b39;
  color: white;
}

#game1-canvas {
    background: #091221;
}

#game2-canvas {
    background: #091221;
}
</style>
</head>
<body>
    <!-- ==========================================================================================================  -->
    
    <div class="modal fade" id="myModal" role="dialog">
        <div class="modal-dialog" style="margin-top:300px;">
            <div class="modal-content">
                <div class="modal-body" style="text-align:center;padding:25px;">
                    <h1 id="modal-text-value"></h1>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ==========================================================================================================  -->
    
    <div id="login-container" class="container" style="text-align:center;width:60%;margin-top:7%;display:none;">
        <img src="fusion_play_icon.png" class="img-circle" style="width:80px">
        <h1>FusionPlay</h1>
        <span> Control with Alexa</span><br><br>
        <h4>Login to continue</h4>
        <button id="google-login-btn" type="button" class="fa fa-google login-btn btn btn-block">
            <span class="lead" style="margin-left:10px;font-size:30px;">Google</span>
        </button> 
        <button id="facebook-login-btn" type="button" class="fa fa-facebook login-btn btn btn-block">
            <span class="lead" style="margin-left:10px;font-size:30px;">Facebook</span>
        </button> 
        <button id="twitter-login-btn" type="button" class="fa fa-twitter login-btn btn btn-block">
            <span class="lead" style="margin-left:10px;font-size:30px;">Twitter</span>
        </button> 
    </div>

    <!-- ==========================================================================================================  -->

    <div id="menu-stage-container" class="container" style="margin-top:10px;display:none;">
        <div style="text-align:right;">
            <button type="button" class="logout-btn btn btn-primary btn-sm" onclick="logout()">Logout</button>
        </div>
        <h1 style="text-align:center;">FusionPlay</h1>
        
        <div id="demo" class="carousel slide" data-interval="false">
            <div class="carousel-inner">
                <div class="carousel-item active" style="text-align:center">
                    <img id="carousel-item-img1" src="fusion_play_icon.png" width="900" height="550">
                    <div class="carousel-caption" style="text-align:center">
                        <h1 id="carousel-item-title1"></h1>
                        <p id="carousel-item-subtitle1"></p>
                    </div>   
                </div>
                <div class="carousel-item" style="text-align:center">
                    <img id="carousel-item-img2" src="fusion_play_icon.png" width="900" height="550">
                    <div class="carousel-caption" style="text-align:center">
                        <h1 id="carousel-item-title2"></h1>
                        <p id="carousel-item-subtitle2"></p>
                    </div>   
                </div>
            </div>
            <a id="prev-game-btn" class="carousel-control-prev" href="#demo" data-slide="prev" style="display:none;">
                <span class="carousel-control-prev-icon"></span>
            </a>
            <a id="next-game-btn" class="carousel-control-next" href="#demo" data-slide="next" style="display:none;">
                <span class="carousel-control-next-icon"></span>
            </a>
        </div>
    </div>

    <!-- ==========================================================================================================  -->

    <div id="play-stage-container" class="container" style="text-align:center;margin-top:2px;display:none;">
        <div style="text-align:right;">
            <button type="button" class="logout-btn btn btn-primary btn-sm" onclick="logout()">Logout</button>
        </div>

        <div id="game1-container" class="container" style="margin-top:10px;display:none;">
            <h3 style="text-align:center;">Game 1</h3>
            <canvas id="game1-canvas" width="1116" height="600"></canvas>
        </div>

        <div id="game2-container" class="container" style="margin-top:10px;display:none;">
            <h3 style="text-align:center;">Game 2</h3>
            <canvas id="game2-canvas" width="1116" height="600"></canvas>
        </div>
    </div>

    <!-- ================================================================================================================== -->

    <script>
        // ------------------------------- Global Variables -------------------------------------------
        var _fusionPlay =  {
            url: "https://v42vex84wk.execute-api.us-east-1.amazonaws.com/dev/console?uid=",
            getUrl: function(){
                return url + window.localStorage.uid;
            },
            stage: undefined,
            menu: {
                current: 1,
                nextGame: function(gameName) {
                    var g = _fusionPlay.gamesByName[gameName];
                    if(g == null) {
                        return;
                    }                    
                    this.current = (this.current == 1 ? 2 : 1);
                    document.getElementById("carousel-item-img" + this.current).src = g['src'];
                    document.getElementById("carousel-item-title" + this.current).innerHTML = g['displayTitle'];
                    document.getElementById("carousel-item-subtitle" + this.current).innerHTML = g['menuDisplaySubTitle'];
                    document.getElementById("next-game-btn").click();
                },
                prevGame: function(gameName) {
                    var g = _fusionPlay.gamesByName[gameName];
                    if(g == null) {
                        return;
                    }
                    this.current = (this.current == 1 ? 2 : 1);
                    document.getElementById("carousel-item-img" + this.current).src = g['src'];
                    document.getElementById("carousel-item-title" + this.current).innerHTML = g['displayTitle'];
                    document.getElementById("carousel-item-subtitle" + this.current).innerHTML = g['menuDisplaySubTitle'];
                    document.getElementById("prev-game-btn").click();
                }
            },
            game: undefined,
            gamesByName: {
                pingPong: {
                    name: 'pingPong',
                    displayTitle: "Ping Pong Game 1",
                    menuDisplaySubTitle: "Control with Alexa | 1",
                    src: "game1_src.png",
                    console: undefined,
                    container: document.getElementById("game1-container"),
                    newInstance: function() {
                        return new FusionPlayGameOneConsole(document.getElementById("game1-canvas"));
                    }
                }
            },
            setGame: function(gameName) {
                if(this.game != null && this.game.console != null) {
                    this.game.console.destroy();
                    this.game.console = null;
                    this.game.container.style.display = "none";
                }
                
                var ng = this.gamesByName[gameName];
                if(ng != null) {
                    if(ng.console != null) {
                        ng.console.destroy();
                    }
                    ng.console = ng.newInstance();
                    ng.console.create();
                    ng.container.style.display = "block";
                }
                this.game = ng;
            },
            setStage: function(newStage){
                switch(newStage) {
                    case "MENU":
                        $('#myModal').modal('hide');
                        document.getElementById("login-container").style.display = "none";
                        document.getElementById("play-stage-container").style.display = "none";
                        document.getElementById("menu-stage-container").style.display = "block";
                        this.stage = newStage;
                        break;
                    case "PLAY":
                        $('#myModal').modal('hide');
                        document.getElementById("login-container").style.display = "none";
                        document.getElementById("menu-stage-container").style.display = "none";
                        document.getElementById("play-stage-container").style.display = "block";
                        this.stage = newStage;
                        break;
                    default:
                        break;
                }
            }
        }

        // helper function to reload webpage
        function reloadThisWebPage() {
            location.reload();
        }

        // gcm event processor
        function processFusionPlayEvent(event) {
            console.log("new trigger: ", event);
            if(event.trigger == "ALEXA_SESSION_STARTED") {
                if(event.stage == null || event.game == null) {
                    return;
                }
                switch(event.stage) {
                    case "MENU":
                        if(_fusionPlay.game != null && _fusionPlay.game.console != null) {
                            _fusionPlay.game.console.destroy();
                        }
                        _fusionPlay.menu.nextGame(_fusionPlay.game);
                        break;
                    case "PLAY":
                        if(_fusionPlay.game == null || _fusionPlay.game.console == null || _fusionPlay.game.console.isDestroyed()) {
                            _fusionPlay.setGame(event.game);
                        } else {
                            event.trigger = 'PAUSE';
                            processFusionPlayEvent(event);
                            return;
                        }
                        break;
                    default:
                        return;
                }
                _fusionPlay.setStage(event.stage);
            } else if(event.trigger == "RESET") {
                reloadThisWebPage();
            } else if (event.stage == "MENU" && (event.trigger  == "NEXT" || event.trigger == "PREV" || event.trigger == "SELECT" || event.trigger == null)) {
                if(event.stage == null || event.game == null) {
                    return;
                }
                if(_fusionPlay.game != null && _fusionPlay.game.console != null) {
                    _fusionPlay.game.console.destroy();
                }
                if(event.trigger == null) {
                    event.trigger = "NEXT";
                }
                switch(event.trigger) {
                    case "SELECT":
                        _fusionPlay.setGame(event.game)
                        _fusionPlay.setStage("PLAY");
                        // todo: play modal
                        document.getElementById("modal-text-value").innerHTML = "PLAY";
                        $('#myModal').modal('show');
                        break;
                    case "PREV":
                        _fusionPlay.setStage("MENU");
                        _fusionPlay.menu.prevGame(event.game);
                        break;
                    case "NEXT":
                        _fusionPlay.setStage("MENU");
                        _fusionPlay.menu.nextGame(event.game);
                        break;
                }
                _fusionPlay.menu.nextGame(_fusionPlay.game);
            } else if (event.stage == "PLAY") {
                if(event.trigger == null) {
                    console.log("null trigger in PLAY stage");
                    return;
                }
                switch(event.trigger) {
                    case "MENU":
                        if(_fusionPlay.game != null && _fusionPlay.game.console != null) {
                            _fusionPlay.game.console.destroy();
                        }
                        _fusionPlay.setStage("MENU");
                        _fusionPlay.menu.prevGame(event.game);
                        break;
                    case "PLAY":
                        if(_fusionPlay.game == null || _fusionPlay.game.console == null || _fusionPlay.game.console.isDestroyed()) {
                            _fusionPlay.setGame(event.game);
                        }
                        if(!_fusionPlay.game.console.isPlaying()){
                            _fusionPlay.setStage("PLAY");
                            _fusionPlay.game.console.play();
                        } else if (_fusionPlay.game.console.isPaused()) {
                            _fusionPlay.setStage("PLAY");
                            _fusionPlay.game.console.resume();
                        }
                        break;
                    case "PAUSE":
                        if(_fusionPlay.game == null 
                            || _fusionPlay.game.console == null 
                            || _fusionPlay.game.console.isDestroyed()) {
                            _fusionPlay.setGame(event.game);
                        }
                        _fusionPlay.setStage("PLAY");
                        _fusionPlay.game.console.pause();
                        console.log("paused");
                        // todo: paused modal
                        document.getElementById("modal-text-value").innerHTML = "PAUSED";
                        $('#myModal').modal('show');
                        break;
                    case "RESUME":
                        if(_fusionPlay.game == null 
                            || _fusionPlay.game.console == null 
                            || _fusionPlay.game.console.isDestroyed() 
                            || !_fusionPlay.game.console.isPlaying() 
                            || !_fusionPlay.game.console.isPaused()) {
                            break;
                        }
                        _fusionPlay.setStage("PLAY");
                        _fusionPlay.game.console.resume();
                        break;
                    case "STOP":
                        if(_fusionPlay.game == null 
                            || _fusionPlay.game.console == null 
                            || _fusionPlay.game.console.isDestroyed() 
                            || !_fusionPlay.game.console.isPlaying()) {
                            break;
                        }
                        _fusionPlay.game.console.stop();
                        _fusionPlay.setStage("PLAY");
                        // todo: re-play modal
                        document.getElementById("modal-text-value").innerHTML = "STOPPED";
                        $('#myModal').modal('show');
                        break;
                    default:
                        if(_fusionPlay.game == null || _fusionPlay.game.console == null || _fusionPlay.game.console.isDestroyed()) {
                            _fusionPlay.setGame(event.game);
                            _fusionPlay.setStage("PLAY");
                        } else {
                            _fusionPlay.setStage("PLAY");
                            _fusionPlay.game.console.controller(event.trigger);
                        }
                        break;
                }
            }
        }
        
        // on success login
        function onSuccessLogin(uid, emailId) {
            window.localStorage.setItem("uid", uid);
            postWebRequest({
                "emailId": emailId,
                "isConsoleLinked": true,
                "gcmToken": window.localStorage.gcmToken
            }, function(result, err) {
                if(err) {
                    document.getElementById("modal-text-value").innerHTML = "<span style='font-size:20px;'>Failed. Refresh the page.</span>";
                    $('#myModal').modal('show');
                    console.log("failed to post web request on success login.", err);
                } else {
                    getWebRequest(function(result, err){
                        if(err)  {
                            document.getElementById("modal-text-value").innerHTML = "<span style='font-size:20px;'>Failed. Refresh the page.</span>";
                            $('#myModal').modal('show');
                            console.log("failed to get web request on success login.");
                        } else {
                            var initialEvent = {
                                'stage': result['stage'] == null ? 'MENU' : result['stage']
                            }
                            switch(initialEvent['stage']) {
                                case 'MENU':
                                    initialEvent['trigger'] = 'NEXT';
                                    break;
                                case 'PLAY':
                                    initialEvent['trigger'] = null;
                                    break;
                                default:
                                    initialEvent['stage'] = 'MENU';
                                    initialEvent['trigger'] = 'NEXT';
                                    break;
                            }
                            initialEvent['game'] = result['game'] == null ? 'pingPong' : result['game'];
                            console.log("initializing console");
                            window.localStorage.setItem('isLoggedOut', false);
                            initialize(initialEvent);
                        }
                    });
                }
            });
        }

        function initialize(event) {
            window.localStorage.setItem('isProcessing', true);
            try {
                processFusionPlayEvent(event);
            } finally {
                window.localStorage.setItem('isProcessing', false);
                firebase.messaging().onMessage(function(payload) {
                    if(window.localStorage.isLoggedOut == "true") {
                        console.log("ignoring new notification. logged out.", triggerMsg);
                        return;
                    }
                    
                    var triggerMsg = JSON.parse(payload.data.default);
                    if(triggerMsg.stage == null || triggerMsg.game == null || triggerMsg.timestamp == null || triggerMsg.timestamp.toString() == '0') {
                        console.log('invalid message received in foreground', triggerMsg);
                        return;
                    }
                    console.log("valid message received in foreground", triggerMsg);
                    
                    
                    var lastTriggerTimestamp = window.localStorage.lastTriggerTimestamp;
                    window.localStorage.setItem('lastTriggerTimestamp', triggerMsg.timestamp);
                    if(lastTriggerTimestamp != null && parseInt(lastTriggerTimestamp) >= parseInt(triggerMsg.timestamp.toString())) {
                        console.log("old message received. lastTriggerTimestamp %s, and payload %s", lastTriggerTimestamp, triggerMsg);
                        return;
                    }

                    if(window.localStorage.isProcessing == 'true') {
                        console.log("already processing. ignoring new message", triggerMsg);
                        return;
                    }
                    
                    window.localStorage.setItem('isProcessing', true);
                    try {
                        processFusionPlayEvent(triggerMsg);
                    } catch(err) {
                        console.log("ERROR WHILE CONSUMING MESSAGE ", payload, err);
                    } finally {
                        window.localStorage.setItem('isProcessing', false);
                    }
                });
                // Testing
                // var i=-1;
                // setInterval(function(){
                //     i++;
                //     if(i == 1) {
                //         processFusionPlayEvent({stage: 'MENU', game: 'pingPong', trigger: 'NEXT'});
                //     } else if(i == 2) {
                //         processFusionPlayEvent({stage: 'MENU', game: 'pingPong2', trigger: 'NEXT'});
                //     } else if (i ==3) {
                //         processFusionPlayEvent({stage: 'MENU', game: 'pingPong', trigger: 'PREV'});
                //     } else if (i ==4) {
                //         processFusionPlayEvent({stage: 'MENU', game: 'pingPong', trigger: 'SELECT'});
                //     } else if (i ==5) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'PLAY'});
                //     } else if (i ==3) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'LEFT'});
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'LEFT'});
                //     } else if (i ==4) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'RIGHT'});
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'RIGHT'});
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'RIGHT'});
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'RIGHT'});
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'RIGHT'});
                //     } else if (i == 5) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'RESUME'});
                //     } else if (i ==6) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'PAUSE'});
                //     } else if (i ==7) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'PLAY'});
                //     } else if (i ==8) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'STOP'});
                //     } else if (i ==9) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'PLAY'});
                //     } else if (i ==10) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'MENU'});
                //     } else if (i ==11) {
                //         processFusionPlayEvent({stage: 'MENU', game: 'pingPong', trigger: 'PREV'});
                //     } else if (i ==12) {
                //         processFusionPlayEvent({stage: 'MENU', game: 'pingPong', trigger: 'SELECT'});
                //     } else if (i ==13) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'PLAY'});
                //     } else if (i ==14) {
                //         processFusionPlayEvent({stage: 'PLAY', game: 'pingPong', trigger: 'RESUME'});
                //     }
                // }, 2000);
                
            }
        }

        var debug = false;
        function getWebRequest(callback) {
            console.log("getWebRequest");
            if(debug) {
                return callback({stage: 'MENU', game: 'pingPong', trigger: 'NEXT'}, null);
            }
            var settings = {
                async: true,
                crossDomain: true,
                url: _fusionPlay.url + window.localStorage.uid,
                method: "GET",
                headers: {
                    "accept": "application/json"
                }
            };
            $.ajax(settings).done(function (response) {
                callback(response, null);
            }).fail(function(xhr, status, error) {
                callback(null, error);
            });
        }

        function putWebRequest(payload, callback) {
            console.log("putWebRequest");
            if(debug) {
                return callback({stage: 'MENU', game: 'pingPong', trigger: 'NEXT'}, null);
            }
            var settings = {
                async: true,
                crossDomain: true,
                url: _fusionPlay.url + window.localStorage.uid,
                method: "PUT",
                headers: {
                    "content-type": "application/json"
                },
                dataType: 'json',
                contentType: "application/json",
                data: JSON.stringify(payload)
            };
            $.ajax(settings).done(function (response) {
                callback(response, null);
            }).fail(function(xhr, status, error) {
                callback(null, error);
            });
        }

        function postWebRequest(payload, callback) {
            console.log("postWebRequest");
            if(debug) {
                return callback({stage: 'MENU', game: 'pingPong', trigger: 'NEXT'}, null);
            }
            var settings = {
                async: true,
                crossDomain: true,
                url: _fusionPlay.url + window.localStorage.uid,
                method: "POST",
                headers: {
                    "content-type": "application/json"
                },
                dataType: 'json',
                contentType: "application/json",
                data: JSON.stringify(payload)
            };
            $.ajax(settings).done(function (response) {
                callback(response, null);
            }).fail(function(xhr, status, error) {
                callback(null, error);
            });
        }

        function logout() {
            window.localStorage.setItem('isLoggedOut', true);
            window.localStorage.setItem('uid', null);
            window.localStorage.setItem('gcmToken', null);
            document.getElementById("modal-text-value").innerHTML = "Un-plugging your Console...";
            $('#myModal').modal('show');
            putWebRequest({
                "isConsoleLinked": false
            }, function(result, err) {
                if(err) {
                    window.localStorage.setItem('isLoggedOut', false);
                    document.getElementById("modal-text-value").innerHTML = "<span style='font-size:20px;'>Failed. Try again.</span>";
                    setTimeout(function(){
                        $('#myModal').modal('hide');
                    }, 1000);
                    console.log("failed to post web request for logout.", err);
                } else {
                    firebase.auth().signOut().then(function() {
                        document.getElementById("modal-text-value").innerHTML = "<span style='font-size:20px;'>Un-plugged.</span>";
                        setTimeout(function(){
                            reloadThisWebPage();
                        }, 1000);
                        console.log('logout success');
                    }).catch(function(error) {
                        document.getElementById("modal-text-value").innerHTML = "<span style='font-size:20px;'>Failed. Try again.</span>";
                        setTimeout(function(){
                            reloadThisWebPage();
                        }, 1000);
                        console.log('logout failed', error);
                    });
                    
                }
            });
        }
        
        // ---------------------------------------- LOADING APP  ---------------------------------------------
        
        // initialization
        window.localStorage.setItem('isLoggedOut', true);
        window.localStorage.setItem('uid', null);
        window.localStorage.setItem('gcmToken', null);
        
        $('#myModal').modal({backdrop: 'static', keyboard: false});
        document.getElementById("modal-text-value").innerHTML = "Loading...";
        $('#myModal').modal('show');

        $(document).ready(function() {
            var messaging = firebase.messaging();
            // register service worker
            navigator.serviceWorker.register('./firebase-messaging-sw.js')
            .then((registration) => {
                messaging.useServiceWorker(registration);
                // request permission
                messaging.requestPermission().then(function() {
                    console.log('Notification permission granted.');
                    // getting gcm token
                    messaging.getToken().then(function(currentToken) {
                        if (currentToken) {
                            // register message listener
                            window.localStorage.setItem("gcmToken", currentToken);
                            // checcking if user is already logged in
                            firebase.auth().onAuthStateChanged(function(user) {
                                if (user) {
                                    var emailId = user['email'];
                                    var uid = user['uid'];
                                    onSuccessLogin(uid, emailId);
                                } else {
                                    setTimeout(function(){
                                        $('#myModal').modal('hide');
                                        document.getElementById("login-container").style.display = "block";
                                    }, 1500);
                                }
                            });                            
                        } else {
                            document.getElementById("modal-text-value").innerHTML = "<span style='font-size:20px;'>Failed. Refresh the page.</span>";
                        }
                    }).catch(function(err) {
                        console.log('An error occurred while retrieving token. ', err);
                        document.getElementById("modal-text-value").innerHTML = "<span style='font-size:20px;'>Failed. Refresh the page.</span>";
                    });
                }).catch(function(err) {
                    console.log('Unable to get permission to notify.');
                    document.getElementById("modal-text-value").innerHTML = "<span style='font-size:20px;'>Grant notification permission and refresh the page.</span>";
                }); 
            });
            
            // on google login button click
            $('#google-login-btn').click(function(e) {  
                document.getElementById("login-container").style.display = "none";
                document.getElementById("modal-text-value").innerHTML = "Please wait...";
                $('#myModal').modal('show');
                var googleProvider = new firebase.auth.GoogleAuthProvider();
                firebase.auth().signInWithPopup(googleProvider).then(function(result) {
                    if(result.user) {
                        var uid = result.user.uid;
                        var emailId = result.user.email;
                        onSuccessLogin(uid, emailId);
                    } else {
                        document.getElementById("modal-text-value").innerHTML = "<span>Login failed</span><br> <span style='font-size:20px;'>Login failed. Try again.</span>";
                        setTimeout(function(){
                            $('#myModal').modal('hide');
                            document.getElementById("login-container").style.display = "block";
                        }, 1500);
                    }
                }).catch(function(error) {
                    document.getElementById("modal-text-value").innerHTML = "<span>Login failed</span><br> <span style='font-size:20px;'>Try again.</span>";
                    setTimeout(function(){
                        $('#myModal').modal('hide');
                        document.getElementById("login-container").style.display = "block";
                    }, 1500);
                });
            });

            // create fb app
            $('#facebook-login-btn').click(function(e) {  
                document.getElementById("login-container").style.display = "none";
                document.getElementById("modal-text-value").innerHTML = "Please wait...";
                $('#myModal').modal('show');
                var fbProvider = new firebase.auth.FacebookAuthProvider();
                firebase.auth().signInWithPopup(fbProvider).then(function(result) {
                    if(result.user) {
                        var uid = result.user.uid;
                        var emailId = result.user.email;
                        onSuccessLogin(uid, emailId);
                    } else {
                        document.getElementById("modal-text-value").innerHTML = "<span>Login failed</span><br> <span style='font-size:20px;'>Login failed. Try again.</span>";
                        setTimeout(function(){
                            $('#myModal').modal('hide');
                            document.getElementById("login-container").style.display = "block";
                        }, 1500);
                    }
                }).catch(function(error) {
                    document.getElementById("modal-text-value").innerHTML = "<span>Login failed</span><br> <span style='font-size:20px;'>Try again.</span>";
                    setTimeout(function(){
                        $('#myModal').modal('hide');
                        document.getElementById("login-container").style.display = "block";
                    }, 1500);
                });
            });

            // create twitter app
            $('#twitter-login-btn').click(function(e) {  
                document.getElementById("login-container").style.display = "none";
                document.getElementById("modal-text-value").innerHTML = "Please wait...";
                $('#myModal').modal('show');
                var twitterProvider = new firebase.auth.TwitterAuthProvider();
                firebase.auth().signInWithPopup(googleProvider).then(function(result) {
                    if(result.user) {
                        var uid = result.user.uid;
                        var emailId = result.user.email;
                        onSuccessLogin(uid, emailId);
                    } else {
                        document.getElementById("modal-text-value").innerHTML = "<span>Login failed</span><br> <span style='font-size:20px;'>Login failed. Try again.</span>";
                        setTimeout(function(){
                            $('#myModal').modal('hide');
                            document.getElementById("login-container").style.display = "block";
                        }, 1500);
                    }
                }).catch(function(error) {
                    document.getElementById("modal-text-value").innerHTML = "<span>Login failed</span><br> <span style='font-size:20px;'>Try again.</span>";
                    setTimeout(function(){
                        $('#myModal').modal('hide');
                        document.getElementById("login-container").style.display = "block";
                    }, 1500);
                });
            });
        });

        // ---------------------------------------------------------------------------------------------------------------

    </script>
</body>
</html> 
